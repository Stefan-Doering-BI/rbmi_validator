<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Contributing to rbmi • rbmi</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Contributing to rbmi"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="articles/advanced.html">rbmi: Advanced Functionality</a>
    <a class="dropdown-item" href="articles/quickstart.html">rbmi: Quickstart</a>
    <a class="dropdown-item" href="articles/stat_specs.html">rbmi: Statistical Specifications</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/rbmi/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Contributing to rbmi</h1>
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/rbmi/blob/HEAD/CONTRIBUTING.md" class="external-link"><code>CONTRIBUTING.md</code></a></small>
    </div>

<div id="contributing-to-rbmi" class="section level1">

<p>This file outlines how to propose and make changes to rbmi as well as
providing details about more obscure aspects of the packages development
process.</p>
<div class="section level2">
<h2 id="code-changes">Code changes<a class="anchor" aria-label="anchor" href="#code-changes"></a></h2>
<p>If you want to make a code contribution, it’s a good idea to first
file an issue and make sure someone from the team agrees that it’s
needed. If you’ve found a bug, please file an issue that illustrates the
bug with a minimal <a href="https://www.tidyverse.org/help/#reprex" class="external-link">reprex</a> (this will also
help you write a unit test, if needed).</p>
<div class="section level3">
<h3 id="pull-request-process">Pull request process<a class="anchor" aria-label="anchor" href="#pull-request-process"></a></h3>
<ul><li><p>This project uses a simple GitHub flow model for development.
That is, code changes should be done in their own feature branch based
off of “main” and merged back into “main” once complete.</p></li>
<li><p>Pull Requests will not be accepted unless all CI/CD checks have
passed. (See the CI/CD section for more information).</p></li>
<li><p>Pull Requests relating to any of the packages core R code must be
accompanied by a corresponding unit test. Any new features or bug fixes
will be rejected if they do not also contain a unit test to demonstrate
that they are working as intended. (See the Unit Testing section for
more information).</p></li>
<li><p>Pull Requests should add a few lines about what has been changed
to the <code>NEWS.md</code> file.</p></li>
</ul></div>
<div class="section level3">
<h3 id="coding-considerations">Coding Considerations<a class="anchor" aria-label="anchor" href="#coding-considerations"></a></h3>
<ul><li><p>We use <a href="https://cran.r-project.org/package=roxygen2" class="external-link">roxygen2</a>, with <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/rd-formatting.html" class="external-link">Markdown
syntax</a>, for documentation.</p></li>
<li><p>Please ensure your code conforms to <code>lintr</code>. You can
check this by running <code>lintr::lint("FILE NAME")</code> on any files
you have modified and ensuring that the findings are kept to as few as
possible. (We do not have any hard requirements on following lintr but
do encourage developers to follow its guidance as closely as
possible)</p></li>
<li><p>This project uses 4 space indents, contributions not following
this will be rejected.</p></li>
<li><p>This project makes use S3 of R6 for OOP. Usage of S4 and other
OOP systems is to be avoided unless absolutely necessary.</p></li>
<li><p>The current desire of this package is to keep the dependency tree
as small as possible. To that end you are discouraged from adding any
additional packages to the “Depends” / “Imports” section unless
absolutely essential. If you are importing a package just to use a
single function consider writing a variant of that function with base R.
There are no such expectations for “Suggests” and you are free to use
any package for the vignettes / unit tests (though again please be
mindful to not be unnecessarily excessive with this).</p></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="unit-testing--cicd">Unit Testing &amp; CI/CD<a class="anchor" aria-label="anchor" href="#unit-testing--cicd"></a></h2>
<p>This project uses <code>testthat</code> to perform unit testing in
combination with GitHub Actions for CI/CD.</p>
<div class="section level3">
<h3 id="scheduled-testing">Scheduled Testing<a class="anchor" aria-label="anchor" href="#scheduled-testing"></a></h3>
<p>Due to the stochastic nature of this package some unit tests take a
considerable amount of time to execute. To avoid issues with usability
unit tests that take more than a couple of seconds to run should be
deferred to the scheduled testing. These are tests that are only run
occasionally on a periodic basis (currently twice a month) and not on
every pull request / push event.</p>
<p>To defer a test to the scheduled build simply include
<code>skip_if_not(is_full_test())</code> to the top of the
<code>test_that()</code> block i.e.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">test_that</span><span class="op">(</span><span class="st">"some unit test"</span>, <span class="op">{</span>
    <span class="fu">skip_if_not</span><span class="op">(</span><span class="fu">is_full_test</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
    <span class="fu">expect_equal</span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>The scheduled tests can also be manually activated by going to “<a href="https://github.com/insightsengineering/rbmi" class="external-link uri">https://github.com/insightsengineering/rbmi</a>” -&gt;
“Actions” -&gt; “Bi-Weekly” -&gt; “Run Workflow”. It is advisable to do
this before releasing to CRAN.</p>
</div>
<div class="section level3">
<h3 id="cran-releases">CRAN Releases<a class="anchor" aria-label="anchor" href="#cran-releases"></a></h3>
<p>In order to release a package to CRAN it needs to be tested across
multiple different OS’s and versions of R. This has been implemented in
this project via a GitHub Action Workflow titled “Check for CRAN” which
needs to be manually activated. To do this go to “<a href="https://github.com/insightsengineering/rbmi" class="external-link uri">https://github.com/insightsengineering/rbmi</a>” -&gt;
“Actions” -&gt; “Check for CRAN” -&gt; “Run Workflow”.</p>
<p>If all these tests pass then the package can be safely released to
CRAN (after updating the relevant <code>cran-comments.md</code>
file)</p>
</div>
<div class="section level3">
<h3 id="docker-images">Docker Images<a class="anchor" aria-label="anchor" href="#docker-images"></a></h3>
<p>To support CI/CD in terms of reducing installation time several
Docker images have been pre-built which contain all the packages and
system dependencies that this project needs. The current relevant images
can be found at:</p>
<ul><li>ghcr.io/insightsengineering/rbmi:r404</li>
<li>ghcr.io/insightsengineering/rbmi:r410</li>
<li>ghcr.io/insightsengineering/rbmi:latest</li>
</ul><p>The <code>latest</code> image is automatically re-built once a month
to contain the latest version of R and its packages. The other versions
are built with older versions of R (as indicated by the tag number) and
contain package versions as they were when that version of R was
released. This is important to ensure that the package works with older
versions of R which many companies typically run due to delays in their
validation processes.</p>
<p>The code to create these images can be found in
<code>misc/docker</code>. The legacy images (i.e. everything excluding
the “latest” image) are only built on manual request by running the
corresponding GitHub Actions Workflow.</p>
</div>
<div class="section level3">
<h3 id="reproducibility-print-tests--snaps">Reproducibility, Print Tests &amp; Snaps<a class="anchor" aria-label="anchor" href="#reproducibility-print-tests--snaps"></a></h3>
<p>A particular issue with testing this package is reproducibility. For
the most part this is handled well via <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> however
stan does not guarentee reproducibility even with the same seed if run
on different hardware.</p>
<p>This issue surfaces itself when testing the print messages of the
<code><a href="reference/pool.html">pool()</a></code> object which displays treatment estimates which are
thus not identical when run on different machines. To address this issue
pre-made print objects have been generated and stored in
<code>R/sysdata.rda</code> (which itself is generated by
<code>data-raw/create_print_test_data.R</code>). The generated print
messages are compared to expected values which are stored in
<code>tests/testthat/_snaps/</code> (which themselves are automatically
created by <code><a href="https://testthat.r-lib.org/reference/expect_snapshot.html" class="external-link">testthat::expect_snapshot()</a></code>)</p>
</div>
</div>
<div class="section level2">
<h2 id="glmmtmb">glmmTMB<a class="anchor" aria-label="anchor" href="#glmmtmb"></a></h2>
<p>The <code>glmmTMB</code> package is responsible for fitting MMRM
models in this package and as such is a critical dependency to this
package. Unfortunately, several issues have cropped up with
<code>glmmTMB</code> over the course of our development. If you do find
any issues with <code>glmmTMB</code> please do raise a ticket on their
repository <a href="https://github.com/glmmTMB/glmmTMB" class="external-link">here</a>.</p>
<p>The most common issue we see is a warning <code>glmmTMB</code> being
compiled against a different version of <code>TMB</code> or
<code>Matrix</code> compared to what you have install locally. The only
real solution to this is to manually recompile the package yourself by
running:</p>
<pre><code><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TMB"</span>, <span class="st">"glmmTMB"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"source"</span><span class="op">)</span></code></pre>
<p>Note that you will need to have rtools installed if you are on
Windows or Xcode on Mac (or somehow else have access to a C/C++
compiler).</p>
</div>
<div class="section level2">
<h2 id="rstan">rstan<a class="anchor" aria-label="anchor" href="#rstan"></a></h2>
<p>The Bayesian models fitted by this package are implemented via
stan/rstan. The code for this can be found in
<code>inst/stan/MMRM.stan</code>. Note that the package will
automatically take care of compiling this code when you install it or
run <code><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">devtools::load_all()</a></code>. Please note that the package
won’t recompile the code unless you have changed the source code or you
delete the <code>src</code> directory.</p>
</div>
<div class="section level2">
<h2 id="vignettes">Vignettes<a class="anchor" aria-label="anchor" href="#vignettes"></a></h2>
<p>CRAN imposes a 10-minute run limit on building, compiling and testing
your package. To keep to this limit the vignettes are thus pre-built.
That is to say that simply just changing the source code will not
automatically update the vignettes, you will need to manually re-build
them.</p>
<p>To do this you need to run:</p>
<pre><code>Rscript vignettes/build.R</code></pre>
<p>Once re-built you will then need to commit the updated html files to
the git repository.</p>
<p>For reference this static vignette process works by using the “asis”
vignette engine provided by <code>R.rsp</code>. This works by getting R
to only recognise vignettes as files ending in <code>*.html.asis</code>
and then builds them by simple copying the corresponding file ending in
<code>*.html</code> to the relevent docs folder in the built
package.</p>
</div>
<div class="section level2">
<h2 id="misc--local-folders">Misc &amp; Local Folders<a class="anchor" aria-label="anchor" href="#misc--local-folders"></a></h2>
<p>The misc folder in this project is used to hold useful scripts,
analyses, simulations &amp; infrastructure code that we wish to keep but
isn’t really essential to the build or deployment of the package. Feel
free to store additional stuff in here that you feel is worth
keeping.</p>
<p>Likewise “local/” has been added to the <code>.gitignore</code> file
meaning anything stored in this folder won’t be committed to the
repository. For example, you may find this useful for storing personal
scripts for testing or more generally exploring.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Craig Gower-Page, Alessandro Noci, Roche.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer></div>

  

  

  </body></html>

