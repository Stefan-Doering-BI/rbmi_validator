% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/draws.R
\name{draws}
\alias{draws}
\alias{draws.approxbayes}
\alias{draws.condmean}
\alias{draws.bayes}
\title{Fit the base imputation model and get parameter estimates}
\usage{
draws(data, data_ice, vars, method)

\method{draws}{approxbayes}(data, data_ice, vars, method)

\method{draws}{condmean}(data, data_ice, vars, method)

\method{draws}{bayes}(data, data_ice, vars, method)
}
\arguments{
\item{data}{A \code{data.frame} containing the data to be used in the model. See details.}

\item{data_ice}{A \code{data.frame} that specifies the information related
to the intercurrent events (ICE) and the imputation strategies. See details.}

\item{vars}{A \code{vars} object as generated by \code{\link[=set_vars]{set_vars()}}. See details.}

\item{method}{A \code{method} object as generated by either \code{\link[=method_bayes]{method_bayes()}},
\code{\link[=method_approxbayes]{method_approxbayes()}} or \code{\link[=method_condmean]{method_condmean()}}.
It specifies the multiple imputation methodology to be used. See details.}
}
\value{
A \code{draws} object which is a named list containing the following:
\itemize{
\item \code{data}: R6 \code{longdata} object containing all relevant input data information.
\item \code{method}: A \code{method} object as generated by either \code{\link[=method_bayes]{method_bayes()}},
\code{\link[=method_approxbayes]{method_approxbayes()}} or \code{\link[=method_condmean]{method_condmean()}}.
\item \code{samples}: list containing the estimated parameters of interest.
Each element of \code{samples} is a named list containing the following:
\itemize{
\item \code{ids}: vector of characters containing the ids of the subjects included in the original dataset.
\item \code{beta}: numeric vector of estimated regression coefficients.
\item \code{sigma}: list of estimated covariance matrices (one for each level of \code{vars$group}).
\item \code{theta}: numeric vector of transformed covariances.
\item \code{failed}: Logical. \code{TRUE} if the model fit failed.
\item \code{ids_samp}: vector of characters containing the ids of the subjects included in the given sample.
}
\item \code{fit}: if \code{method_bayes()} is chosen, returns the MCMC Stan fit object. Otherwise \code{NULL}.
\item \code{n_failures}: absolute number of failures of the model fit.
Relevant only for \code{method_condmean(type = "bootstrap")} and \code{method_approxbayes()}.
\item \code{formula}: fixed effects formula object used for the model specification.
}
}
\description{
fits the base imputation model to the observed data assuming MAR
according to the given multiple imputation methodology and returns the parameter
estimates from the fit.
}
\details{
\code{draws} performs the first step of the multiple imputation (MI) procedure: fitting the
base imputation model. The goal is to estimate the parameters of interest needed
for the imputation phase (i.e. the regression coefficients and the covariance matrices
from a MMRM model).

The function distinguishes between the following methods:
\itemize{
\item Bayesian MI based on MCMC sampling: \code{draws} returns the draws
from the posterior distribution of the parameters using a Bayesian approach based on
MCMC sampling. This method can be specified by using \code{method = method_bayes()}.
\item Approximate Bayesian MI based on bootstrap: \code{draws} returns
the draws from the posterior distribution of the parameters using a Bayesian approach,
where the sampling from the posterior distribution is simulated by fitting the MMRM model
on bootstrap samples of the original dataset. This method can be specified by using \verb{method = method_approxbayes()]}.
\item Conditional mean imputation with bootstrap re-sampling: \code{draws} returns the
MMRM parameter estimates from the original dataset and from \code{n_samples} bootstrap samples.
This method can be specified by using \code{method = method_condmean()} with
argument \code{type = "bootstrap"}.
\item Conditional mean imputation with Jackknife re-sampling: \code{draws} returns the
MMRM parameter estimates from the original dataset and from each leave-one-out sample.
This method can be specified by using \code{method = method_condmean()} with
argument \code{type = "jackknife"}.
}

The argument \code{data} must have one row per visit per subject. This means that incomplete
outcome data must be set as \code{NA} instead of having the related row missing. Missing values
in the covariates are not allowed. If \code{data} is incomplete
then the \code{\link[=expand_locf]{expand_locf()}} helper function can be used to add in any missing rows, which uses
Last Observation Carried Forward (LOCF) imputation to impute the covariates values.

The argument \code{data_ice} contains information about the occurrence of ICEs. It is a
\code{data.frame} with 3 columns:
\itemize{
\item A vector of characters related to the ids of the subjects that experienced
the ICE (must be named as \code{vars$subjid}).
\item A vector containing the first visit after the occurrence of the ICE (must be named as \code{vars$visit}).
This value must be equal to one of the levels of \code{data[[vars$visit]]}.
If multiple ICEs happen for the same subject, then only the first non-MAR visit should be used.
\item A vector of characters related to the imputation strategy to address the ICE (must be named as \code{vars$strategy}).
Possible imputation strategies are:
\itemize{
\item \code{"MAR"}: Missing At Random.
\item \code{"JTR"}: Jump To Reference.
\item \code{"CIR"}: Copy Increments in Reference.
\item \code{"CR"}: Copy Reference.
\item \code{"JR"}: Jump to Reference.
\item \code{"LMCF"}: Last Mean Carried Forward.
\item User-defined imputation strategies can also be set.
}
}

This argument is necessary at this stage since the model is fitted
after removing the observations whose underlying assumption is different from MAR.
Thus, any observed data after \code{data_ice[[vars$visit]]} that is addressed with an imputation
strategy different from MAR is excluded for the model fit. However such observations
will not be discarded from the data in the imputation phase
(performed with the function (\code{\link[=impute]{impute()}}). To summarize, \strong{at this stage only pre-ICE data
and post-ICE data that is MAR are used}.

The vars argument is a named list that specifies the names of key variables within
\code{data} and \code{data_ice}. Please use \code{\link[=set_vars]{set_vars()}}. In particular the following named elements are used:
\itemize{
\item \code{subjid}: name of the column in \code{data} and \code{data_ice} which contains the subject ids variable.
\item \code{visit}: name of the column in \code{data} and \code{data_ice} which contains the visit variable.
\item \code{outcome}: name of the column in \code{data} which contains the outcome variable.
\item \code{group}: name of the column in \code{data} which contains the group variable.
\item \code{covariates}: vector of characters which contains the covariates to be included
in the model (including interactions).
By default the model specification is \code{outcome ~ 1 + visit + group}.
Please note that the \code{group*visit} interaction
is \strong{not} included in the model by default.
\item \code{strata}: covariates used as stratification variables in the bootstrap.
By default only the \code{vars$group} is set as stratification variable.
Needed only for \code{method_condmean(type = "bootstrap")} and \code{method_approxbayes()}.
\item \code{strategy}: name of the column in \code{data_ice} which contains the subject-specific imputation strategy.
}
}
\seealso{
\code{\link[=method_bayes]{method_bayes()}}, \code{\link[=method_approxbayes]{method_approxbayes()}}, \code{\link[=method_condmean]{method_condmean()}} for setting \code{method}.

\code{\link[=set_vars]{set_vars()}} for setting \code{vars}.

\code{\link[=expand_locf]{expand_locf()}} for expanding \code{data} in case of missing rows.

For more details see the quickstart vignette:
\code{vignette("quickstart", package = "rbmi")}.
}
