<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rbmi">
<title>rbmi: Advanced Functionality • rbmi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rbmi: Advanced Functionality">
<meta property="og:description" content="rbmi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/advanced.html">rbmi: Advanced Functionality</a>
    <a class="dropdown-item" href="../articles/quickstart.html">rbmi: Quickstart</a>
    <a class="dropdown-item" href="../articles/stat_specs.html">rbmi: Statistical Specifications</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>rbmi: Advanced Functionality</h1>
            
      
      
      <div class="d-none name"><code>advanced.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The purpose of this vignette is to provide an overview of some of the more advanced features of the <code>rbmi</code> package.</p>
<p>In order to demonstrate these advanced functions we will first create a simulated dataset and perform a mock analysis so that all the require objects are available.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rbmi</span><span class="op">)</span>
<span class="co">#&gt; Warning in checkMatrixPackageVersion(): Package version inconsistency detected.</span>
<span class="co">#&gt; TMB was built with Matrix version 1.3.4</span>
<span class="co">#&gt; Current Matrix version is 1.4.0</span>
<span class="co">#&gt; Please re-install 'TMB' from source using install.packages('TMB', type = 'source') or ask CRAN for a binary version of 'TMB' matching CRAN's 'Matrix' package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">169</span><span class="op">)</span>
<span class="va">dat_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate_data.html">simulate_data</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">120</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## Introduce missingness</span>
<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat_full</span>
<span class="va">missing_index_vis2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0.3</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">dat</span><span class="op">$</span><span class="va">visit</span> <span class="op">==</span> <span class="st">"visit_2"</span>
<span class="va">missing_index_vis3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0.4</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">dat</span><span class="op">$</span><span class="va">visit</span> <span class="op">==</span> <span class="st">"visit_3"</span>
<span class="va">dat</span><span class="op">[</span><span class="va">missing_index_vis2</span>, <span class="st">"outcome"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_real_</span>
<span class="va">dat</span><span class="op">[</span><span class="va">missing_index_vis3</span>, <span class="st">"outcome"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA_real_</span>

<span class="co"># create data_ice setting the imputation method to MAR for</span>
<span class="co"># each patient with at least one missing value</span>
<span class="va">dat_ice</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">visit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">outcome</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">visit</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="st">"MAR"</span><span class="op">)</span>


<span class="co"># Define the names of key variables in our dataset using `set_vars()`</span>
<span class="co"># Note that covariates argument can contain interactions</span>
<span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span>
    outcome <span class="op">=</span> <span class="st">"outcome"</span>,
    visit <span class="op">=</span> <span class="st">"visit"</span>,
    subjid <span class="op">=</span> <span class="st">"id"</span>,
    group <span class="op">=</span> <span class="st">"group"</span>,
    covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"group*visit"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="efficiently-changing-imputation-strategies">Efficiently Changing Imputation Strategies<a class="anchor" aria-label="anchor" href="#efficiently-changing-imputation-strategies"></a>
</h2>
<p>The <code><a href="../reference/draws.html">draws()</a></code> function is by far the most computationally intensive function in <code>rbmi</code>. In some settings, it may be important to explore the impact of a different reference-based imputation strategy than the one chosen for the main analysis. This change in the imputation strategy does not affect the imputation model but it does affect the subsequent imputation step. In order to allow changes in the imputation strategy without having to re-run the <code><a href="../reference/draws.html">draws()</a></code> function, the function <code><a href="../reference/impute.html">impute()</a></code> has an additional argument <code>update_strategies</code>.</p>
<p>Please note though that this functionality comes with a some key limitations: From a theoretical point of view, such updates are only sensible if the base imputation model and the data to which it is fitted are also applicable to the revised imputation strategy. For example, as described in <code><a href="../reference/draws.html">help("draws", "rbmi")</a></code>, observed post-ICE data are included in the imputation model for the MAR strategy but excluded for non-MAR strategies. For this reason, the imputation strategy cannot be changed from MAR to a non-MAR strategy in the presence of observed data after the ICE. Likewise, a change from a non-MAR to MAR in the presence of observed data after the ICE triggers a warning because the imputation model was not fitted to all relevant data and may be inefficient. Similarly, it is not possible to change the first visit which is affected by an ICE via argument <code>update_strategies</code>.</p>
<p>As an example, let’s assume we want to use the copy increments from reference strategy for the main analysis and explore the jump to reference imputation strategy as a sensitivity analysis. If we use approximate Bayesian multiple imputation with 10 random imputation, this could be implemented as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_ice_CIR</span> <span class="op">&lt;-</span> <span class="va">dat_ice</span>
<span class="va">dat_ice_CIR</span><span class="op">$</span><span class="va">strategy</span> <span class="op">&lt;-</span> <span class="st">"CIR"</span>
<span class="va">dat_ice_CIR</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 72 × 3</span></span>
<span class="co">#&gt;    id    visit   strategy</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> P001  visit_2 CIR     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> P005  visit_3 CIR     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> P006  visit_2 CIR     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> P007  visit_2 CIR     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> P008  visit_2 CIR     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> P009  visit_2 CIR     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> P013  visit_3 CIR     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> P014  visit_3 CIR     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> P015  visit_2 CIR     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> P016  visit_2 CIR     </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 62 more rows</span></span>

<span class="va">draw_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draws.html">draws</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">dat</span>,
    data_ice <span class="op">=</span> <span class="va">dat_ice_CIR</span>,
    vars <span class="op">=</span> <span class="va">vars</span>,
    method <span class="op">=</span> <span class="fu"><a href="../reference/method.html">method_approxbayes</a></span><span class="op">(</span>n_sample<span class="op">=</span><span class="fl">10</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated running time (assuming single core) is 5.36 seconds</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Progress:  10%</span>
<span class="co">#&gt; Progress:  20%</span>
<span class="co">#&gt; Progress:  30%</span>
<span class="co">#&gt; Progress:  40%</span>
<span class="co">#&gt; Progress:  50%</span>
<span class="co">#&gt; Progress:  60%</span>
<span class="co">#&gt; Progress:  70%</span>
<span class="co">#&gt; Progress:  80%</span>
<span class="co">#&gt; Progress:  90%</span>
<span class="co">#&gt; Progress: 100%</span>

<span class="va">impute_obj_CIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span>
    <span class="va">draw_obj</span>,
    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="st">"B"</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">ana_obj_CIR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span>
    <span class="va">impute_obj_CIR</span>,
    vars <span class="op">=</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">ana_obj_CIR</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Pool Object</span>
<span class="co">#&gt; -----------</span>
<span class="co">#&gt; Number of Results Combined: 10</span>
<span class="co">#&gt; Method: rubin</span>
<span class="co">#&gt; Confidence Level: 0.95</span>
<span class="co">#&gt; Alternative: two.sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   ========================================================</span>
<span class="co">#&gt;       parameter      est     se     lci     uci     pval  </span>
<span class="co">#&gt;   --------------------------------------------------------</span>
<span class="co">#&gt;      trt_visit_1    0.107   0.772  -1.421  1.636    0.89  </span>
<span class="co">#&gt;    lsm_ref_visit_1   10.7   0.546   9.62   11.781  &lt;0.001 </span>
<span class="co">#&gt;    lsm_alt_visit_1  10.808  0.546  9.727   11.889  &lt;0.001 </span>
<span class="co">#&gt;      trt_visit_2    3.694   1.262  1.161   6.227   0.005  </span>
<span class="co">#&gt;    lsm_ref_visit_2  12.399  1.007  10.338  14.459  &lt;0.001 </span>
<span class="co">#&gt;    lsm_alt_visit_2  16.093  0.814  14.475  17.71   &lt;0.001 </span>
<span class="co">#&gt;      trt_visit_3    6.044   1.414  3.202   8.886   &lt;0.001 </span>
<span class="co">#&gt;    lsm_ref_visit_3  14.575  1.083  12.371  16.779  &lt;0.001 </span>
<span class="co">#&gt;    lsm_alt_visit_3  20.619  0.963  18.693  22.546  &lt;0.001 </span>
<span class="co">#&gt;   --------------------------------------------------------</span>

<span class="co">## Now we re-use our draws samples but using the Jump to Reference </span>
<span class="co">## Imputation strategy</span>

<span class="va">dat_ice_JR</span> <span class="op">&lt;-</span> <span class="va">dat_ice</span>
<span class="va">dat_ice_JR</span><span class="op">$</span><span class="va">strategy</span> <span class="op">&lt;-</span> <span class="st">"JR"</span>
<span class="va">dat_ice_JR</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 72 × 3</span></span>
<span class="co">#&gt;    id    visit   strategy</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> P001  visit_2 JR      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> P005  visit_3 JR      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> P006  visit_2 JR      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> P007  visit_2 JR      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> P008  visit_2 JR      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> P009  visit_2 JR      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> P013  visit_3 JR      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> P014  visit_3 JR      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> P015  visit_2 JR      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> P016  visit_2 JR      </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 62 more rows</span></span>

<span class="va">impute_obj_JR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span>
    <span class="va">draw_obj</span>,
    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="st">"B"</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span>,
    update_strategy <span class="op">=</span> <span class="va">dat_ice_JR</span>
<span class="op">)</span>

<span class="va">ana_obj_JR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span>
    <span class="va">impute_obj_JR</span>,
    vars <span class="op">=</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">ana_obj_JR</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Pool Object</span>
<span class="co">#&gt; -----------</span>
<span class="co">#&gt; Number of Results Combined: 10</span>
<span class="co">#&gt; Method: rubin</span>
<span class="co">#&gt; Confidence Level: 0.95</span>
<span class="co">#&gt; Alternative: two.sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   ========================================================</span>
<span class="co">#&gt;       parameter      est     se     lci     uci     pval  </span>
<span class="co">#&gt;   --------------------------------------------------------</span>
<span class="co">#&gt;      trt_visit_1    0.107   0.772  -1.421  1.636    0.89  </span>
<span class="co">#&gt;    lsm_ref_visit_1   10.7   0.546   9.62   11.781  &lt;0.001 </span>
<span class="co">#&gt;    lsm_alt_visit_1  10.808  0.546  9.727   11.889  &lt;0.001 </span>
<span class="co">#&gt;      trt_visit_2    3.684   1.271  1.141   6.226   0.005  </span>
<span class="co">#&gt;    lsm_ref_visit_2  12.432  0.953  10.51   14.353  &lt;0.001 </span>
<span class="co">#&gt;    lsm_alt_visit_2  16.116  0.868  14.385  17.846  &lt;0.001 </span>
<span class="co">#&gt;      trt_visit_3    5.267   1.368  2.529   8.005   &lt;0.001 </span>
<span class="co">#&gt;    lsm_ref_visit_3  15.616  1.006  13.593  17.64   &lt;0.001 </span>
<span class="co">#&gt;    lsm_alt_visit_3  20.883  0.906  19.082  22.684  &lt;0.001 </span>
<span class="co">#&gt;   --------------------------------------------------------</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-imputation-strategies">Custom Imputation Strategies<a class="anchor" aria-label="anchor" href="#custom-imputation-strategies"></a>
</h2>
<p>The following imputation strategies are implemented in <code>rbmi</code>:</p>
<ul>
<li>Missing at Random (MAR)</li>
<li>Jump to Reference (JR)</li>
<li>Copy Reference (CR)</li>
<li>Copy Increments from Reference (CIR)</li>
<li>Last Mean Carried Forward (LMCF)</li>
</ul>
<p>In addition, <code>rbmi</code> allows the user to implement their own imputation strategy. To do this there are three things which the user needs to do:</p>
<ol style="list-style-type: decimal">
<li>Define their own imputation strategy function.</li>
<li>Specify which patients use this strategy in the <code>data_ice</code> dataset provided to <code><a href="../reference/draws.html">draws()</a></code>.</li>
<li>Provide the imputation strategy function to <code><a href="../reference/impute.html">impute()</a></code>.</li>
</ol>
<p>The imputation strategy function must take 3 arguments (<code>pars_group</code>, <code>pars_ref</code>, and <code>index_mar</code>) and calculates the marginal mean trajectory and covariance matrix of a subject’s marginal imputation distribution which will then be applied to subjects to which the strategy applies. Here, <code>pars_group</code> contains the predicted mean trajectory (<code>pars_group$mu</code>, a numeric vector) and covariance matrix (<code>pars_group$sigma</code>) for a subject conditional on their assigned treatment group and covariates. <code>pars_ref</code> contains the corresponding mean trajectory and covariance matrix conditional on the reference group and the subject’s covariates. <code>index_mar</code> is a logical vector which specifies for each visit whether the visit is unaffected by an ICE handled using reference-based methods or not. As an example, the user can check how the CIR strategy was implemented by looking at function <code><a href="../reference/stratgies.html">strategy_CIR()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">strategy_CIR</span>
<span class="co">#&gt; function (pars_group, pars_ref, index_mar) </span>
<span class="co">#&gt; {</span>
<span class="co">#&gt;     if (all(index_mar)) {</span>
<span class="co">#&gt;         return(pars_group)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     else if (all(!index_mar)) {</span>
<span class="co">#&gt;         return(pars_ref)</span>
<span class="co">#&gt;     }</span>
<span class="co">#&gt;     mu &lt;- pars_group$mu</span>
<span class="co">#&gt;     last_mar &lt;- which(!index_mar)[1] - 1</span>
<span class="co">#&gt;     increments_from_last_mar_ref &lt;- pars_ref$mu[!index_mar] - </span>
<span class="co">#&gt;         pars_ref$mu[last_mar]</span>
<span class="co">#&gt;     mu[!index_mar] &lt;- mu[last_mar] + increments_from_last_mar_ref</span>
<span class="co">#&gt;     sigma &lt;- compute_sigma(sigma_group = pars_group$sigma, sigma_ref = pars_ref$sigma, </span>
<span class="co">#&gt;         index_mar = index_mar)</span>
<span class="co">#&gt;     pars &lt;- list(mu = mu, sigma = sigma)</span>
<span class="co">#&gt;     return(pars)</span>
<span class="co">#&gt; }</span>
<span class="co">#&gt; &lt;bytecode: 0x562980b2f1f0&gt;</span>
<span class="co">#&gt; &lt;environment: namespace:rbmi&gt;</span></code></pre></div>
<p>To further illustrate this for a simple example, assume that a strategy is to be implemented according to which the marginal mean of the imputation distribution is equal to the marginal mean trajectory for the subject according to their assigned group and covariates up to the ICE and equal to the average of the visit-wise marginal means based on the subjects covariates and the assigned group or the reference group, respectively. For the covariance matrix of the marginal imputation distribution, the covariance matrix from the assigned group is taken.</p>
<p>To do this, we first need to define the imputation function which for this example could be coded as:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">strategy_AVG</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">pars_group</span>, <span class="va">pars_ref</span>, <span class="va">index_mar</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">mean_xy</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span>
    <span class="va">mu_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span>
        <span class="va">mean_xy</span>,
        <span class="va">pars_group</span><span class="op">$</span><span class="va">mu</span>,
        <span class="va">pars_ref</span><span class="op">$</span><span class="va">mu</span>,
        SIMPLIFY <span class="op">=</span> <span class="cn">T</span>
    <span class="op">)</span>
    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">pars_group</span>
    <span class="va">x</span><span class="op">$</span><span class="va">mu</span><span class="op">[</span><span class="op">!</span><span class="va">index_mar</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu_mean</span><span class="op">[</span><span class="op">!</span><span class="va">index_mar</span><span class="op">]</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>And an example showing its use:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pars_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,
    sigma <span class="op">=</span> <span class="fu"><a href="../reference/simulate_data.html">as_vcov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.5</span>, <span class="fl">0.45</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">pars_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    mu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>,
    sigma <span class="op">=</span> <span class="fu"><a href="../reference/simulate_data.html">as_vcov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.8</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">index_mar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">strategy_AVG</span><span class="op">(</span><span class="va">pars_group</span>, <span class="va">pars_ref</span>, <span class="va">index_mar</span><span class="op">)</span>
<span class="co">#&gt; $mu</span>
<span class="co">#&gt; [1] 1 2 5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $sigma</span>
<span class="co">#&gt;      [,1] [,2] [,3]</span>
<span class="co">#&gt; [1,]  1.0  1.2  1.0</span>
<span class="co">#&gt; [2,]  1.2  9.0  2.7</span>
<span class="co">#&gt; [3,]  1.0  2.7  4.0</span></code></pre></div>
<p>To incorporate this into <code>rbmi</code>, <code>data_ice</code> needs to be updated such that subjects are specified as using the <code>AVG</code> imputation strategy. Additionally, the function needs to be provided to <code><a href="../reference/impute.html">impute()</a></code> via the <code><a href="../reference/getStrategies.html">getStrategies()</a></code> function as shown below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_ice</span><span class="op">$</span><span class="va">strategy</span> <span class="op">&lt;-</span> <span class="st">"AVG"</span>
<span class="va">dat_ice</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 72 × 3</span></span>
<span class="co">#&gt;    id    visit   strategy</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> P001  visit_2 AVG     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> P005  visit_3 AVG     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> P006  visit_2 AVG     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> P007  visit_2 AVG     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> P008  visit_2 AVG     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> P009  visit_2 AVG     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> P013  visit_3 AVG     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> P014  visit_3 AVG     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> P015  visit_2 AVG     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> P016  visit_2 AVG     </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 62 more rows</span></span>

<span class="va">draw_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/draws.html">draws</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">dat</span>,
    data_ice <span class="op">=</span> <span class="va">dat_ice</span>,
    vars <span class="op">=</span> <span class="va">vars</span>,
    method <span class="op">=</span> <span class="fu"><a href="../reference/method.html">method_approxbayes</a></span><span class="op">(</span>n_sample<span class="op">=</span><span class="fl">10</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Estimated running time (assuming single core) is 4.61 seconds</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Progress:  10%</span>
<span class="co">#&gt; Progress:  20%</span>
<span class="co">#&gt; Progress:  30%</span>
<span class="co">#&gt; Progress:  40%</span>
<span class="co">#&gt; Progress:  50%</span>
<span class="co">#&gt; Progress:  60%</span>
<span class="co">#&gt; Progress:  70%</span>
<span class="co">#&gt; Progress:  80%</span>
<span class="co">#&gt; Progress:  90%</span>
<span class="co">#&gt; Progress: 100%</span>

<span class="va">impute_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/impute.html">impute</a></span><span class="op">(</span>
    <span class="va">draw_obj</span>,
    references <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="st">"B"</span>, <span class="st">"B"</span> <span class="op">=</span> <span class="st">"B"</span><span class="op">)</span>,
    strategies <span class="op">=</span> <span class="fu"><a href="../reference/getStrategies.html">getStrategies</a></span><span class="op">(</span>AVG <span class="op">=</span> <span class="va">strategy_AVG</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="custom-analysis-functions">Custom Analysis Functions<a class="anchor" aria-label="anchor" href="#custom-analysis-functions"></a>
</h2>
<p>By default <code>rbmi</code> will analyse the data by using the <code><a href="../reference/ancova.html">ancova()</a></code> function as the analysis function which fits an ANCOVA model to the outcomes from each visit separately, and returns the “treatment effect” estimate as well as the corresponding least square means for each group. If the user wants to perform a different analysis, or return different statistics from the analysis, then this can be done by using a custom analysis function. Beware that for conditional mean imputation, the consistency of treatment effect estimation has only been formally established for analysis functions corresponding to linear models (such as ANCOVA) and caution is required when applying alternative analysis functions.</p>
<p>The custom analysis function must take a <code>data.frame</code> as its first argument and return a named <code>list</code> with each element itself being a <code>list</code> containing a at a minimum a point estimate, called <code>est</code>. For method <code><a href="../reference/method.html">method_bayes()</a></code> or <code><a href="../reference/method.html">method_approxbayes()</a></code>, the list must additionally contain a standard error (element <code>se</code>) and, if available, the degrees of freedom of the complete-data analysis model (element <code>df</code>).</p>
<p>As an example, let’s say that the analysis compares the proportion of subjects with an outcome &gt; 10 at the last visit between the groups without any covariate adjustment. This could then lead to the following (naive) analysis function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">compare_prop_lastvisit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>,<span class="va">...</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">outcome</span> <span class="op">&gt;</span> <span class="fl">10</span><span class="op">)</span> <span class="op">~</span> <span class="va">group</span>,
      family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span>,
      data <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="va">data</span><span class="op">[[</span><span class="st">"visit"</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="st">"visit_3"</span>, <span class="op">]</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> 
      est <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"groupB"</span>, <span class="st">"Estimate"</span><span class="op">]</span>,
      se <span class="op">=</span> <span class="va">fit</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"groupB"</span>, <span class="st">"Std. Error"</span><span class="op">]</span>,
      df <span class="op">=</span> <span class="cn">Inf</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>The user should be aware that according to Rubin’s rules, if the degrees of freedom from the complete-data analysis model is infinite, this does not imply that the pooled degrees of freedom is also infinite. It can be proven that in this case the pooled degrees of freedom is <code>(M-1)/lambda^2</code>, where <code>M</code> is the number of imputations and <code>lambda</code> is the fraction of missing information. Please see <span class="citation">Barnard and Rubin (1999)</span> for details. If you want to force the pooled degrees of freedom to be <code>Inf</code>, please set <code>df = NA</code> as returned value from the analysis function.</p>
<p>This analysis function can then be used in combination with <code><a href="../reference/analyse.html">analyse()</a></code> as follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">anl_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span>
    imputations <span class="op">=</span> <span class="va">impute_obj_CIR</span>,
    fun <span class="op">=</span> <span class="va">compare_prop_lastvisit</span><span class="op">)</span>

<span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">anl_obj</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Pool Object</span>
<span class="co">#&gt; -----------</span>
<span class="co">#&gt; Number of Results Combined: 10</span>
<span class="co">#&gt; Method: rubin</span>
<span class="co">#&gt; Confidence Level: 0.95</span>
<span class="co">#&gt; Alternative: two.sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   =============================================</span>
<span class="co">#&gt;    parameter   est    se    lci    uci   pval  </span>
<span class="co">#&gt;   ---------------------------------------------</span>
<span class="co">#&gt;       trt     2.601  1.12  0.355  4.847  0.024 </span>
<span class="co">#&gt;   ---------------------------------------------</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="delta-adjustment">Delta Adjustment<a class="anchor" aria-label="anchor" href="#delta-adjustment"></a>
</h2>
<p>The <code>delta</code> argument of <code><a href="../reference/analyse.html">analyse()</a></code> allows users to modify the outcome variable which can be utilised as part of a tipping point or sensitivity analysis. To do this, the user needs to provide a <code>data.frame</code> containing a column for the subject and visit which identifies the observation to be adjusted, and then a 3rd column called <code>delta</code> which specifies the value which will be added to the outcome prior to the analysis.</p>
<p>The <code><a href="../reference/delta_template.html">delta_template()</a></code> function creates a skeleton <code>data.frame</code> containing 1 row per subject per visit with the value of delta set to 0 for all observations. The <code><a href="../reference/delta_template.html">delta_template()</a></code> function has two additional mandatory arguments <code>delta</code> and <code>dlag</code> which allow the user to specify initial cumulative delta values based upon a default value and a scaling coefficient based upon how far away the visit in question is from the ICE visit.</p>
<p>More specifically; the <code>delta</code> argument specifies the default amount of delta that should be applied to each post-ICE visit, whilst <code>dlag</code> specifies the scaling coefficient to be applied based upon the visits proximity to first visit affected by the ICE. By default, the delta will only be added to unobserved (i.e. imputed) post-ICE outcomes but this can be changed by setting the optional argument <code>missing_only = FALSE</code>.</p>
<p>The usage of the <code>delta</code> and <code>dlag</code> arguments is best illustrated with a few examples:</p>
<p>Let <code>delta = c(5,6,7,8)</code> and <code>dlag=c(1,2,3,4)</code> (i.e. assuming there are 4 visits) and lets say that the subject’s first visit affected by the ICE is visit 2. The calculation would then be as follows:</p>
<pre><code>v1  v2  v3  v4
--------------
 5   6   7   8  # delta assigned to each visit
 0   1   2   3  # scaling starting from the first visit after the subjects ICE
--------------
 0   6  14  24  # delta * scaling
--------------
 0   6  20  44  # accumulative sum / delta to be applied to each visit</code></pre>
<p>That is to say the subject would have a delta offset of 0 applied for visit v1, 6 for visit v2, 20 for visit v3 and 44 for visit v4. As a comparison, lets say that the subject instead that the subject’s first visit affected by the ICE was visit 3. Then, would be as follows:</p>
<pre><code>v1  v2  v3  v4
--------------
 5   6   7   8  # delta assigned to each visit
 0   0   1   2  # scaling starting from the first visit after the subjects ICE
--------------
 0   0   7  16  # delta * scaling
--------------
 0   0   7  23  # accumulative sum / delta to be applied to each visit</code></pre>
<p>If one alternatively wanted to apply a constant delta value of 5 to all visits affected by the ICE regarrdless of their proximity to the first ICE visit, this could be achieved by setting <code>delta = c(5,5,5,5)</code> and <code>dlag = c(1,0,0,0)</code>. For example lets say the first visit v1 was already affected by the ICE for a subject. Then the calculation would be as follows:</p>
<pre><code>v1  v2  v3  v4
--------------
 5   5   5   5  # delta assigned to each visit
 1   0   0   0  # scaling starting from the first visit after the subjects ICE
--------------
 5   0   0  0  # delta * scaling
--------------
 5   5   5  5  # accumulative sum / delta to be applied to each visit</code></pre>
<p>!!! I tried to clean up the wording accordingly but ran into some problems. Please help to fix this!</p>
<p>Another way of using these arguments is to set delta to be the difference in time between visits and dlag to be the amount of delta per unit of time. For example lets say that we have a visit on weeks 1, 5, 6 &amp; 9 and that we want a delta of 3 to be applied for each week after an ICE. This can be achieved by setting <code>delta = c(0,4,1,3)</code> (the difference in weeks between each visit) and <code>dlag = c(3/2, 3, 3, 3)</code>. For example subjects who experienced an ICE between visit v1 and v2 we might assume that the ICE happened at half way between the two visits, that is, at week 3. Then the first visit affected by the ICE would be visit v2 (i.e at week 5) and the calculation would be:</p>
<pre><code>v1  v2  v3  v4
--------------
 0   4   1   3  # delta assigned to each visit
 0   3/2   3   3  # scaling starting from the first visit after the subjects ICE 
--------------
 0   6   3   9  # delta * scaling
--------------
 0   0   3  12  # accumulative sum / delta to be applied to each visit</code></pre>
<p>i.e. on week-6 (1 week after the ICE) they have a delta of 3 and on week-9 (4 weeks after the ICE) they have a delta of 12</p>
<p>To show this in action, lets say that we want a constant delta of 5 to be applied (regardless of the lag) to all unobserved post-ICE visits in the treatment arm only. This can be achieved as follows:</p>
<p>First use the <code>delta</code> and <code>dlag</code> arguments of <code><a href="../reference/delta_template.html">delta_template()</a></code> to setup a template <code>data.frame</code> in which every unobserved post-ICE visit has a delta of 5:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delta_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/delta_template.html">delta_template</a></span><span class="op">(</span>
    <span class="va">impute_obj_CIR</span>, 
    delta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, 
    dlag <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">delta_df</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 360 × 8</span></span>
<span class="co">#&gt;    id    visit   group is_mar is_missing is_post_ice strategy delta</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> P001  visit_1 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> P001  visit_2 A     FALSE  TRUE       TRUE        CIR          5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> P001  visit_3 A     FALSE  FALSE      TRUE        <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> P002  visit_1 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> P002  visit_2 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> P002  visit_3 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> P003  visit_1 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> P003  visit_2 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> P003  visit_3 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> P004  visit_1 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 350 more rows</span></span></code></pre></div>
<p>Next we can use the additional metadata variables provided by <code><a href="../reference/delta_template.html">delta_template()</a></code> to manually reset the delta values for the control group back to 0:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">delta_df2</span> <span class="op">&lt;-</span> <span class="va">delta_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>delta <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">group</span> <span class="op">==</span> <span class="st">"B"</span>, <span class="fl">0</span>, <span class="va">delta</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">delta_df2</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 360 × 8</span></span>
<span class="co">#&gt;    id    visit   group is_mar is_missing is_post_ice strategy delta</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> P001  visit_1 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> P001  visit_2 A     FALSE  TRUE       TRUE        CIR          5</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> P001  visit_3 A     FALSE  FALSE      TRUE        <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> P002  visit_1 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> P002  visit_2 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> P002  visit_3 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> P003  visit_1 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> P003  visit_2 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> P003  visit_3 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> P004  visit_1 A     TRUE   FALSE      FALSE       <span style="color: #BB0000;">NA</span>           0</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 350 more rows</span></span></code></pre></div>
<p>Finally we can now use our delta <code>data.frame</code> to apply our desired delta offset to our analysis:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">anl_delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/analyse.html">analyse</a></span><span class="op">(</span><span class="va">impute_obj_CIR</span>, delta <span class="op">=</span> <span class="va">delta_df2</span>, vars <span class="op">=</span> <span class="fu"><a href="../reference/set_vars.html">set_vars</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/pool.html">pool</a></span><span class="op">(</span><span class="va">anl_delta</span><span class="op">)</span>  
<span class="co">#&gt; </span>
<span class="co">#&gt; Pool Object</span>
<span class="co">#&gt; -----------</span>
<span class="co">#&gt; Number of Results Combined: 10</span>
<span class="co">#&gt; Method: rubin</span>
<span class="co">#&gt; Confidence Level: 0.95</span>
<span class="co">#&gt; Alternative: two.sided</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Results:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   ========================================================</span>
<span class="co">#&gt;       parameter      est     se     lci     uci     pval  </span>
<span class="co">#&gt;   --------------------------------------------------------</span>
<span class="co">#&gt;      trt_visit_1    0.107   0.772  -1.421  1.636    0.89  </span>
<span class="co">#&gt;    lsm_ref_visit_1   10.7   0.546   9.62   11.781  &lt;0.001 </span>
<span class="co">#&gt;    lsm_alt_visit_1  10.808  0.546  9.727   11.889  &lt;0.001 </span>
<span class="co">#&gt;      trt_visit_2    2.111   1.295  -0.487  4.708   0.109  </span>
<span class="co">#&gt;    lsm_ref_visit_2  13.982  1.028  11.884  16.08   &lt;0.001 </span>
<span class="co">#&gt;    lsm_alt_visit_2  16.093  0.84   14.424  17.761  &lt;0.001 </span>
<span class="co">#&gt;      trt_visit_3    4.294   1.472  1.342   7.246   0.005  </span>
<span class="co">#&gt;    lsm_ref_visit_3  16.325  1.121  14.052  18.598  &lt;0.001 </span>
<span class="co">#&gt;    lsm_alt_visit_3  20.619  1.005  18.611  22.627  &lt;0.001 </span>
<span class="co">#&gt;   --------------------------------------------------------</span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Barnard1999" class="csl-entry">
Barnard, John, and Donald B Rubin. 1999. <span>“Miscellanea. Small-Sample Degrees of Freedom with Multiple Imputation.”</span> <em>Biometrika</em> 86 (4): 948–55.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Craig Gower-Page, Alessandro Noci, Roche.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
